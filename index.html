<!doctype html>
<meta charset="utf-8">
<script>
(function() {
  const params = new URLSearchParams(location.search);
  let q = params.get("q");

  if (!q) {
    document.write("Usage: ?q=1+1");
    return;
  }

  q = decodeURIComponent(q.replace(/\+/g, "%2B"));
  if ((q.startsWith('"') && q.endsWith('"')) || (q.startsWith("'") && q.endsWith("'")))
    q = q.slice(1, -1);

  // Validate expression
  if (!/^[0-9+\-*/^().\s]+$/.test(q)) {
    document.write("Error: invalid characters");
    return;
  }

  try {
    const result = Function(`"use strict";return (${q.replace(/\^/g, "**")})`)();
    if (typeof result === "number" && isFinite(result)) {
      document.write(result);
    } else {
      document.write("Error: invalid expression");
    }
  } catch (e) {
    document.write("Error: " + e.message);
  }
})();
</script>
